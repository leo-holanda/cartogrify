<main>
  <div class="data-wrapper">
    <h1>Results</h1>
    <div class="data-selector-wrapper">
      <button (click)="setSelectedData(DataTypes.COUNTRIES)" class="data-selector">
        Countries
      </button>
      <button (click)="setSelectedData(DataTypes.REGIONS)" class="data-selector">Regions</button>
      <button (click)="setSelectedData(DataTypes.ARTISTS)" class="data-selector">Artists</button>
    </div>
    <div *ngIf="selectedData == DataTypes.COUNTRIES" class="data">
      <h2 class="data-title">Top Countries</h2>
      <div class="data-content-wrapper">
        <table>
          <tr *ngFor="let country of countries">
            <td>
              <span class="{{ 'flag fi fi-' + country[1].country.code.toLowerCase() }}"></span>
              <span>{{ country[1].country.name }}</span>
            </td>
            <td>
              <span>{{ country[1].count }}</span>
            </td>
          </tr>
        </table>
      </div>
    </div>
    <div *ngIf="selectedData == DataTypes.REGIONS" class="data">
      <h2 class="data-title">Top Regions</h2>
      <div class="data-content-wrapper">
        <div *ngFor="let region of regions">
          <div class="geo-data">
            <span>{{ region[1].regionName }}</span>
            <span>{{ region[1].count }}</span>
          </div>
          <div *ngFor="let subRegion of region[1].subRegions">
            <div class="geo-data sub-region-data">
              <span>{{ subRegion.subRegionName }}</span>
              <span>{{ subRegion.count }}</span>
            </div>
            <div
              class="geo-data intermediate-region-data"
              *ngFor="let intermediateRegion of subRegion.intermediateRegions"
            >
              <span>{{ intermediateRegion.intermediateRegionName }}</span>
              <span>{{ intermediateRegion.count }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="selectedData == DataTypes.ARTISTS" class="data">
      <h2 class="data-title">Top Artists</h2>
      <div class="data-content-wrapper">
        <table>
          <tr *ngFor="let artist of artists$ | async">
            <td>
              {{ artist.name }}
            </td>
            <td class="country-row">
              <span
                class="{{
                  'flag fi fi-' +
                    (artist.country == null ? 'xx' : artist.country?.code?.toLowerCase())
                }}"
              >
              </span>
              {{ artist.country?.name || "Unknown" }}
            </td>
          </tr>
        </table>
      </div>
    </div>
  </div>
  <div #mapWrapper class="map-wrapper"></div>
</main>
