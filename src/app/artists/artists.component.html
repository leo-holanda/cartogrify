<main>
  <div #mapWrapper class="map-wrapper" [style]="{ background: mapBackgroundColor }">
    <div [ngStyle]="{ visibility: shareMode ? 'collapse' : 'visible' }" class="map-buttons">
      <p-button
        (onClick)="op.toggle($event)"
        label="Change color theme"
        icon="pi pi-palette"
        styleClass="p-button-sm"
      ></p-button>
      <p-button
        (onClick)="onShareButtonClick()"
        label="Share with your friends"
        icon="pi pi-share-alt"
        styleClass="p-button-sm"
      ></p-button>
      <p-overlayPanel #op>
        <div class="color-theme-selector">
          <label class="map-color-palette" for="map-color-palette">Color Palette</label>
          <p-listbox
            [options]="colorPalettes"
            optionLabel="name"
            [listStyle]="{ 'max-height': '250px' }"
            (onClick)="onColorPaletteSelect($event)"
          >
            <ng-template let-palette pTemplate="item">
              <div>
                <div>{{ palette.title }}</div>
                <div class="palette-colors-array">
                  <div
                    *ngFor="let color of palette.colors"
                    style="width: 1rem; height: 1rem"
                    [ngStyle]="{ background: color }"
                  ></div>
                </div>
              </div> </ng-template
          ></p-listbox>
          <div class="map-background-input-wrapper">
            <label for="background">Background Color</label>
            <div class="map-background-input">
              <p-radioButton
                name="dark-background"
                value="rgb(50, 50, 50)"
                [(ngModel)]="mapBackgroundColor"
                inputId="dark-background"
              ></p-radioButton>
              <label for="dark-background">Dark</label>
            </div>
            <div class="map-background-input">
              <p-radioButton
                name="light-background"
                value="rgb(255, 255, 255)"
                [(ngModel)]="mapBackgroundColor"
                inputId="light-background"
              ></p-radioButton>
              <label for="light-background">Light</label>
            </div>
            <div class="map-background-input">
              <p-radioButton
                name="blue-background"
                value="rgb(156, 192, 249)"
                [(ngModel)]="mapBackgroundColor"
                inputId="blue-background"
              ></p-radioButton>
              <label for="blue-background">Light blue</label>
            </div>
            <div class="map-background-input">
              <p-radioButton
                name="light-brown-background"
                value="rgb(229, 220, 203)"
                [(ngModel)]="mapBackgroundColor"
                inputId="light-brown-background"
              ></p-radioButton>
              <label for="light-brown-background">Light brown</label>
            </div>
            <div class="map-background-input">
              <p-radioButton
                name="dark-brown-background"
                value="rgb(214, 187, 140)"
                [(ngModel)]="mapBackgroundColor"
                inputId="dark-brown-background"
              ></p-radioButton>
              <label for="dark-brown-background">Dark brown</label>
            </div>
          </div>
        </div>
      </p-overlayPanel>
    </div>
    <div [ngStyle]="{ visibility: shareMode ? 'visible' : 'collapse' }" class="map-title">
      <h1>Your map</h1>
    </div>
    <div class="logo">
      <h1>cartogrify</h1>
    </div>
  </div>
  <p-dialog
    header="Choose the content you want to share"
    [(visible)]="shareMode"
    [style]="{ width: '35rem' }"
    [modal]="true"
  >
    <div class="download-options">
      <p-button (onClick)="shareMap()" label="Map"></p-button>
      <p-button (onClick)="shareRanking()" label="Ranking"></p-button>
    </div>
  </p-dialog>
  <div class="data-wrapper">
    <div>
      <h1>Results</h1>
    </div>
    <p-tabMenu
      [model]="items"
      [activeItem]="items[0]"
      (activeItemChange)="onActiveItemChange($event)"
    ></p-tabMenu>
    <div class="data" *ngIf="activeItem == DataTypes.COUNTRIES">
      <div>
        <h2 class="data-title">Ranking</h2>
        <span class="data-subtitle">by artists per country</span>
      </div>
      <div class="data-content-wrapper">
        <table>
          <thead>
            <th>Country</th>
            <th>Artists</th>
          </thead>
          <tr *ngFor="let countryData of countriesData; let i = index">
            <td class="country-column">
              <div>
                <span class="{{ 'flag fi fi-' + countryData.country.flagCode }}"></span>
              </div>
              <div class="country-column-data">
                <span>{{ countryData.country.name }}</span>
                <p-progressBar [value]="(countryData.count / artists.length) * 100"></p-progressBar>
              </div>
            </td>
            <td class="count-column">
              <span>{{ countryData.count }}</span>
            </td>
          </tr>
        </table>
      </div>
    </div>

    <div class="data" *ngIf="activeItem == DataTypes.REGIONS">
      <h2 class="data-title">Top Regions</h2>
      <div class="data-content-wrapper region-data-wrapper">
        <div *ngFor="let region of regionsData">
          <div class="geo-data">
            <span>{{ region.name }}</span>
            <span>{{ region.count }}</span>
          </div>
          <div *ngFor="let intermediateRegion of region.intermediateRegions">
            <div class="geo-data sub-region-data">
              <span>{{ intermediateRegion.name + " (" + intermediateRegion.count + ")" }}</span>
            </div>
            <div
              class="geo-data intermediate-region-data"
              *ngFor="let subRegion of intermediateRegion.subRegions"
            >
              <span>{{ subRegion.name + " (" + subRegion.count + ")" }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="data" *ngIf="activeItem == DataTypes.ARTISTS">
      <div *ngIf="isMessageActive">
        <p-messages severity="warn">
          <ng-template pTemplate>
            <div>
              <span class="pi pi-exclamation-triangle suggestion-message-icon"></span>
            </div>
            <div class="suggestion-message">
              <div>
                <i>"Why is it saying that Taylor Swift was born in North Korea?"</i>
                <div class="suggestion-message-content">
                  Sometimes, the little robot that guesses the artist's country of origin might be
                  way off the target. He's trying his best. You can help him by suggesting the
                  correct country of origin for your favourite artists!
                </div>
              </div>
              <div class="suggestion-message-close-btn">
                <p-button
                  (onClick)="hideMessage()"
                  styleClass="p-ripple p-element p-message-close p-link"
                  icon="pi pi-times"
                ></p-button>
              </div>
            </div>
          </ng-template>
        </p-messages>
      </div>
      <div class="data-title-wrapper">
        <h2 class="data-title">Top Artists</h2>
        <p-button (onClick)="openDialog()" label="Suggest correct countries"></p-button>
      </div>
      <div class="data-content-wrapper">
        <table>
          <tr *ngFor="let artist of artists; let i = index">
            <td
              class="data-index"
              [ngClass]="{
                'first-place': i == 0,
                'second-place': i == 1,
                'third-place': i == 2
              }"
            >
              {{ "#" + (i + 1) }}
            </td>
            <td>
              <div class="artist-data">
                <span class="artist-name">
                  {{ artist.name }}
                </span>
                <div>
                  <span
                    class="{{
                      'flag fi fi-' + (artist.country == null ? 'xx' : artist.country.flagCode)
                    }}"
                  >
                  </span>
                  <span class="country-name">
                    {{ artist.country?.name || "Unknown" }}
                  </span>
                </div>
              </div>
            </td>
          </tr>
        </table>
      </div>
    </div>
  </div>
</main>
